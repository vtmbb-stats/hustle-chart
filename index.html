<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VT Men's Basketball Hustle Chart</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        /* Ensure full page dark mode */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        
        .dark-mode {
            background-color: #111827 !important;
        }
        
        .light-mode {
            background-color: #f9fafb !important;
        }
    </style>
</head>
<body class="dark-mode">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback, useEffect } = React;

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDabJZx_x3SJEYk1dWwHJw0wUsp48yUWxc",
            authDomain: "vtmbb-hustle-chart.firebaseapp.com",
            projectId: "vtmbb-hustle-chart",
            storageBucket: "vtmbb-hustle-chart.firebasestorage.app",
            messagingSenderId: "210232739134",
            appId: "1:210232739134:web:78ed344affb9f8c0ba586f"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const HustleChartInput = () => {
            const [practiceDate, setPracticeDate] = useState(new Date().toISOString().split('T')[0]);
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [playerStats, setPlayerStats] = useState({});
            const [allData, setAllData] = useState([]);
            const [saveStatus, setSaveStatus] = useState('saved');
            const [darkMode, setDarkMode] = useState(true);

            // Update body class when dark mode changes
            useEffect(() => {
                document.body.className = darkMode ? 'dark-mode' : 'light-mode';
            }, [darkMode]);

            // Your actual roster
            const players = [
                { number: 0, lastName: "Bedford", firstName: "Jailen" },
                { number: 1, lastName: "Lawal", firstName: "Tobi" },
                { number: 2, lastName: "Schutt", firstName: "Jaden" },
                { number: 3, lastName: "Hammond", firstName: "Ben" },
                { number: 4, lastName: "Pasha", firstName: "Izaiah" },
                { number: 5, lastName: "Jones", firstName: "Sin'Cere" },
                { number: 7, lastName: "Freeman", firstName: "Brett" },
                { number: 10, lastName: "Johnson", firstName: "Tyler" },
                { number: 13, lastName: "Hansberry", firstName: "Amani" },
                { number: 15, lastName: "Peterkin", firstName: "Snook" },
                { number: 17, lastName: "Avdalas", firstName: "Neo" },
                { number: 22, lastName: "Davis", firstName: "Solomon" },
                { number: 32, lastName: "Gurdak", firstName: "Christian" },
                { number: 77, lastName: "Dorn", firstName: "Antonio" }
            ];

            const hustleStats = {
                "Offensive": [
                    "Offensive Rebound", "Assist", 
                    "Screen Assist", "Gretzky", "Turnover"
                ],
                "Defensive": [
                    "Steal", "Deflection", "Charge Drawn", "Foul", 
                    "No Crash-Get Back", "Missed Close Out", "Missed Box Out"
                ],
                "Intangibles": [
                    "Hustle Play", "Body Language", "Positive Coach's Point", "Negative Coach's Point"
                ]
            };

            const getPlayerKey = (playerNumber) => `${practiceDate}-${playerNumber}`;

            const getStatValue = useCallback((playerNumber, stat) => {
                const key = getPlayerKey(playerNumber);
                return playerStats[key]?.[stat] || 0;
            }, [playerStats, practiceDate]);

            // Load existing data from Firebase for the current practice date
            const loadExistingData = useCallback(async () => {
                try {
                    const practiceDoc = db.collection('practiceSummaries').doc(practiceDate);
                    const practiceSnapshot = await practiceDoc.get();
                    
                    if (practiceSnapshot.exists) {
                        const currentData = practiceSnapshot.data();
                        const loadedPlayerStats = {};
                        
                        // Convert Firebase data back to our format
                        Object.entries(currentData.playerStats || {}).forEach(([playerKey, stats]) => {
                            const playerNumber = parseInt(playerKey.replace('player_', ''));
                            const key = getPlayerKey(playerNumber);
                            loadedPlayerStats[key] = { ...stats };
                        });
                        
                        setPlayerStats(loadedPlayerStats);
                    } else {
                        // Clear stats if no data exists for this date
                        setPlayerStats({});
                    }
                } catch (error) {
                    console.error('Error loading existing data:', error);
                }
            }, [practiceDate]);

            // Load data when practice date changes
            useEffect(() => {
                loadExistingData();
            }, [loadExistingData]);

            // Save data to Firebase
            const saveToFirebase = useCallback(async (eventData) => {
                try {
                    setSaveStatus('saving');
                    
                    // Save individual event
                    await db.collection('hustleEvents').add({
                        ...eventData,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update practice summary
                    const practiceDoc = db.collection('practiceSummaries').doc(practiceDate);
                    const practiceSnapshot = await practiceDoc.get();
                    
                    if (practiceSnapshot.exists) {
                        const currentData = practiceSnapshot.data();
                        const playerKey = `player_${eventData.playerNumber}`;
                        const currentPlayerStats = currentData.playerStats?.[playerKey] || {};
                        const newStatValue = (currentPlayerStats[eventData.stat] || 0) + eventData.change;
                        
                        await practiceDoc.update({
                            [`playerStats.${playerKey}.${eventData.stat}`]: Math.max(0, newStatValue),
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } else {
                        const initialData = {
                            practiceDate: practiceDate,
                            playerStats: {
                                [`player_${eventData.playerNumber}`]: {
                                    [eventData.stat]: Math.max(0, eventData.change)
                                }
                            },
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        await practiceDoc.set(initialData);
                    }
                    
                    setSaveStatus('saved');
                } catch (error) {
                    console.error('Error saving to Firebase:', error);
                    setSaveStatus('error');
                    setTimeout(() => setSaveStatus('saved'), 3000);
                }
            }, [practiceDate]);

            const updateStat = useCallback((playerNumber, stat, change) => {
                const key = getPlayerKey(playerNumber);
                
                setPlayerStats(prev => {
                    const newStats = { ...prev };
                    if (!newStats[key]) {
                        newStats[key] = {};
                    }
                    
                    const currentValue = newStats[key][stat] || 0;
                    const newValue = Math.max(0, currentValue + change);
                    newStats[key][stat] = newValue;
                    
                    return newStats;
                });

                // Create event data
                const eventData = {
                    practiceDate,
                    playerNumber,
                    playerName: players.find(p => p.number === playerNumber)?.lastName || 'Unknown',
                    firstName: players.find(p => p.number === playerNumber)?.firstName || '',
                    stat,
                    change,
                    timestamp: new Date().toISOString()
                };
                
                setAllData(prev => [...prev, eventData]);
                
                // Save to Firebase
                saveToFirebase(eventData);
            }, [practiceDate, players, saveToFirebase]);

            const handlePlayerSelect = (playerNumber) => {
                setSelectedPlayer(playerNumber);
            };

            const StatSpinner = ({ playerNumber, stat, category }) => {
                const value = getStatValue(playerNumber, stat);
                const isNegativeStat = ['Turnover', 'Foul', 'No Crash-Get Back', 'Missed Close Out', 'Missed Box Out', 'Body Language', 'Negative Coach\'s Point'].includes(stat);
                
                return React.createElement('div', {
                    className: `flex items-center justify-between p-3 rounded-lg border ${
                        isNegativeStat 
                            ? darkMode ? 'bg-red-900/50 border-red-800' : 'bg-red-50 border-red-200'
                            : darkMode ? 'bg-green-900/50 border-green-800' : 'bg-green-50 border-green-200'
                    }`
                }, [
                    React.createElement('div', { className: "flex-1", key: "label" }, [
                        React.createElement('div', {
                            className: `text-sm font-medium ${
                                isNegativeStat 
                                    ? darkMode ? 'text-red-300' : 'text-red-800'
                                    : darkMode ? 'text-green-300' : 'text-green-800'
                            }`,
                            key: "stat-name"
                        }, stat)
                    ]),
                    React.createElement('div', { className: "flex items-center gap-2", key: "controls" }, [
                        React.createElement('button', {
                            onClick: () => updateStat(playerNumber, stat, -1),
                            disabled: value === 0,
                            className: `w-8 h-8 rounded-full flex items-center justify-center font-bold text-white transition-colors ${
                                value === 0 
                                    ? 'bg-gray-300 cursor-not-allowed' 
                                    : isNegativeStat
                                    ? 'bg-green-500 hover:bg-green-600 active:bg-green-700'
                                    : 'bg-red-500 hover:bg-red-600 active:bg-red-700'
                            }`,
                            key: "minus-btn"
                        }, '−'),
                        React.createElement('div', {
                            className: `w-12 text-center font-bold text-lg ${
                                isNegativeStat 
                                    ? darkMode ? 'text-red-300' : 'text-red-700'
                                    : darkMode ? 'text-green-300' : 'text-green-700'
                            }`,
                            key: "value"
                        }, value),
                        React.createElement('button', {
                            onClick: () => updateStat(playerNumber, stat, 1),
                            className: `w-8 h-8 rounded-full flex items-center justify-center font-bold text-white transition-colors ${
                                isNegativeStat
                                    ? 'bg-red-500 hover:bg-red-600 active:bg-red-700'
                                    : 'bg-green-500 hover:bg-green-600 active:bg-green-700'
                            }`,
                            key: "plus-btn"
                        }, '+')
                    ])
                ]);
            };

            const getSaveStatusDisplay = () => {
                switch(saveStatus) {
                    case 'saving':
                        return {
                            color: 'text-yellow-600',
                            dot: 'bg-yellow-500',
                            text: 'Saving...'
                        };
                    case 'error':
                        return {
                            color: 'text-red-600',
                            dot: 'bg-red-500',
                            text: 'Save error'
                        };
                    default:
                        return {
                            color: 'text-green-600',
                            dot: 'bg-green-500',
                            text: 'Saved to cloud'
                        };
                }
            };

            const statusDisplay = getSaveStatusDisplay();

            const toggleDarkMode = () => {
                setDarkMode(prev => !prev);
            };

            return React.createElement('div', { className: `max-w-6xl mx-auto p-4 min-h-screen` }, [
                // Header
                React.createElement('div', { className: `rounded-lg shadow-md p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`, key: "header" }, [
                    React.createElement('div', { className: "flex flex-col sm:flex-row justify-between items-center gap-4" }, [
                        React.createElement('h1', { className: `text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}` }, "Virginia Tech Basketball Hustle Chart"),
                        React.createElement('div', { className: "flex items-center gap-4" }, [
                            React.createElement('button', {
                                onClick: () => window.open('scrimmage.html', '_blank'),
                                className: `px-3 py-2 rounded-md transition-colors ${darkMode ? 'bg-purple-600 text-white hover:bg-purple-700' : 'bg-purple-500 text-white hover:bg-purple-600'}`
                            }, 'Make Teams'),
                            React.createElement('button', {
                                onClick: toggleDarkMode,
                                className: `px-3 py-2 rounded-md transition-colors ${darkMode ? 'bg-gray-700 text-white hover:bg-gray-600' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`
                            }, darkMode ? '☀️ Light' : '🌙 Dark'),
                            React.createElement('div', { className: "flex items-center gap-2" }, [
                                React.createElement('label', { className: `text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'}` }, "Practice Date:"),
                                React.createElement('input', {
                                    type: "date",
                                    value: practiceDate,
                                    onChange: (e) => setPracticeDate(e.target.value),
                                    className: `px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${darkMode ? 'border-gray-600 bg-gray-700 text-white' : 'border-gray-300 bg-white text-gray-900'}`
                                })
                            ]),
                            React.createElement('div', { className: `flex items-center gap-2 text-sm ${statusDisplay.color} min-w-32` }, [
                                React.createElement('div', { 
                                    className: `w-2 h-2 ${statusDisplay.dot} rounded-full ${saveStatus === 'saving' ? 'animate-pulse' : ''}` 
                                }),
                                React.createElement('span', {}, statusDisplay.text)
                            ])
                        ])
                    ])
                ]),
                
                // Player Selection
                React.createElement('div', { className: `rounded-lg shadow-md p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`, key: "players" }, [
                    React.createElement('h2', { className: `text-xl font-semibold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}` }, "Select Player"),
                    React.createElement('div', { className: "grid grid-cols-7 gap-3" }, 
                        players.map((player) => 
                            React.createElement('button', {
                                key: player.number,
                                onClick: () => handlePlayerSelect(player.number),
                                className: `p-4 rounded-lg border-2 transition-all font-semibold text-lg ${
                                    selectedPlayer === player.number
                                        ? 'border-blue-500 bg-blue-100 text-blue-800 shadow-md scale-105'
                                        : darkMode 
                                        ? 'border-gray-600 bg-gray-700 text-gray-200 hover:border-gray-500 hover:bg-gray-600'
                                        : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50'
                                }`
                            }, [
                                React.createElement('div', { className: "text-2xl font-bold", key: "number" }, player.number),
                                React.createElement('div', { className: "text-sm", key: "name" }, player.lastName)
                            ])
                        )
                    )
                ]),

                // Stats Input or Empty State
                selectedPlayer !== null ? 
                    React.createElement('div', { className: `rounded-lg shadow-md p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`, key: "stats" }, [
                        React.createElement('h2', { className: `text-xl font-semibold mb-4 ${darkMode ? 'text-white' : 'text-gray-800'}` }, 
                            `Stats for ${players.find(p => p.number === selectedPlayer)?.firstName} ${players.find(p => p.number === selectedPlayer)?.lastName}`
                        ),
                        React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" },
                            Object.entries(hustleStats).map(([category, stats]) =>
                                React.createElement('div', { key: category, className: "space-y-3" }, [
                                    React.createElement('h3', {
                                        className: `text-lg font-semibold text-center py-2 px-4 rounded-lg ${darkMode ? 'bg-gray-700 text-gray-200' : 'bg-gray-100 text-gray-800'}`,
                                        key: "category-title"
                                    }, category),
                                    ...stats.map((stat) =>
                                        React.createElement(StatSpinner, {
                                            key: stat,
                                            playerNumber: selectedPlayer,
                                            stat: stat,
                                            category: category
                                        })
                                    )
                                ])
                            )
                        )
                    ]) :
                    React.createElement('div', { className: `rounded-lg shadow-md p-12 text-center ${darkMode ? 'bg-gray-800' : 'bg-white'}`, key: "empty" },
                        React.createElement('div', { className: `text-lg ${darkMode ? 'text-gray-400' : 'text-gray-500'}` }, "Select a player to start tracking hustle stats")
                    )
            ]);
        };

        ReactDOM.render(React.createElement(HustleChartInput), document.getElementById('root'));
    </script>
</body>
</html>

